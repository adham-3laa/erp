<Page x:Class="erp.Views.Reports.CommissionReportPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
      FlowDirection="RightToLeft"
      Background="#F5F6FA">

    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- 🔝 Top Nav -->
        <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
            <Button Content="📊 تقرير المبيعات" Click="OpenSalesReport" Margin="0,0,8,0"/>
            <Button Content="📦 حركة صنف" Click="OpenStockMovementReport" Margin="0,0,8,0"/>
            <Button Content="💰 عمولات المندوبين"
                    Background="#1E1B4B"
                    Foreground="White"/>
        </StackPanel>

        <!-- 🧾 العنوان -->
        <TextBlock Grid.Row="1"
                   Text="تقرير عمولات المندوبين"
                   FontSize="22"
                   FontWeight="Bold"
                   Margin="0,0,0,12"/>

        <!-- 🔍 البحث -->
        <materialDesign:Card Grid.Row="2"
                             Padding="16"
                             Margin="0,0,0,16"
                             materialDesign:ElevationAssist.Elevation="Dp2">

            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBox Text="{Binding SalesRepId}"
                         Height="40"
                         materialDesign:HintAssist.Hint="رقم المندوب (SalesRep ID)"/>

                <Button Grid.Column="1"
                        Content="تحميل التقرير"
                        Command="{Binding LoadReportCommand}"
                        Margin="12,0,0,0"
                        Padding="24,8"/>
            </Grid>
        </materialDesign:Card>

        <!-- 📊 المحتوى -->
        <Grid Grid.Row="3">

            <!-- الجدول (دايمًا موجود) -->
            <materialDesign:Card Padding="8"
                                 materialDesign:ElevationAssist.Elevation="Dp1">

                <DataGrid ItemsSource="{Binding Items}"
          AutoGenerateColumns="False"
          CanUserAddRows="False"
          RowHeight="40">

                    <DataGrid.Columns>
                        <DataGridTextColumn Header="اسم المندوب"
                            Binding="{Binding SalesRepName}"
                            Width="*"/>

                        <DataGridTextColumn Header="إجمالي العمولات"
                            Binding="{Binding TotalCommission}"
                            Width="200"/>

                        <DataGridTextColumn Header="عدد الطلبات"
                            Binding="{Binding TotalOrdersConfirmed}"
                            Width="200"/>
                    </DataGrid.Columns>
                </DataGrid>

            </materialDesign:Card>

            <!-- ⏳ Loading Overlay -->
            <Border Background="#80FFFFFF"
                    Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}">
                <StackPanel HorizontalAlignment="Center"
                            VerticalAlignment="Center">
                    <ProgressBar Width="200"
                                 Height="6"
                                 IsIndeterminate="True"/>
                    <TextBlock Text="جاري تحميل التقرير..."
                               Margin="0,8,0,0"/>
                </StackPanel>
            </Border>

            <!-- 📭 لا توجد بيانات -->
            <TextBlock Text="لا توجد بيانات"
                       FontSize="16"
                       Foreground="Gray"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center"
                       Visibility="{Binding NoData, Converter={StaticResource BoolToVisibilityConverter}}"/>
        </Grid>
    </Grid>
</Page>
