<Page x:Class="erp.Views.Orders.CreateOrderPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="clr-namespace:erp.Views.Orders"
      Background="{StaticResource PageBgBrush}"
      FlowDirection="RightToLeft">

    <Page.Resources>
        <DropShadowEffect x:Key="PrimaryOutlineGlow"
                          Color="{Binding Color, Source={StaticResource PrimaryBrush}}"
                          BlurRadius="16"
                          ShadowDepth="0"
                          Opacity="0.35"/>

        <Style x:Key="GlowingTableOuterBorder" TargetType="Border">
            <Setter Property="CornerRadius" Value="16"/>
            <Setter Property="Background" Value="{StaticResource CardBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{StaticResource PrimaryBrush}"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="Effect" Value="{StaticResource PrimaryOutlineGlow}"/>
        </Style>
    </Page.Resources>

    <Grid Margin="24" MinWidth="720">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- TopBar -->
        <local:OrdersTopBar x:Name="OrdersTopBarControl"
                            Grid.Row="0"/>

        <!-- Header -->
        <TextBlock Grid.Row="1"
                   Text="إنشاء طلب جديد"
                   FontSize="26"
                   FontWeight="Bold"
                   Foreground="{StaticResource TextDarkBrush}"
                   HorizontalAlignment="Center"
                   Margin="0,16"/>

        <!-- Form -->
        <Border Grid.Row="2"
                Style="{StaticResource GlowingTableOuterBorder}"
                Width="700"
                HorizontalAlignment="Center">

            <StackPanel>

                <!-- اسم العميل -->
                <TextBlock Text="اسم العميل"
                           Foreground="{StaticResource TextMutedBrush}"/>
                <TextBox x:Name="CustomerNameTextBox"
                         Height="36"
                         Margin="0,4,0,12"/>

                <!-- اسم المندوب -->
                <TextBlock Text="اسم المندوب"
                           Foreground="{StaticResource TextMutedBrush}"/>
                <TextBox x:Name="SalesRepNameTextBox"
                         Height="36"
                         Margin="0,4,0,12"/>

                <!-- العمولة -->
                <TextBlock Text="نسبة العمولة (%)"
                           Foreground="{StaticResource TextMutedBrush}"/>
                <TextBox x:Name="CommissionTextBox"
                         Height="36"
                         Margin="0,4,0,16"
                         PreviewTextInput="NumberOnly"/>

                <!-- المنتجات -->
                <TextBlock Text="المنتجات"
                           FontWeight="SemiBold"
                           Margin="0,0,0,6"/>

                <DataGrid x:Name="ItemsGrid"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          Height="220"
                          Margin="0,0,0,16">

                    <DataGrid.Columns>
                        <DataGridTextColumn Header="اسم المنتج"
                                            Binding="{Binding productname}"
                                            Width="*"/>

                        <DataGridTextColumn Header="الكمية"
                                            Binding="{Binding quantity}"
                                            Width="120"/>

                        <DataGridTemplateColumn Width="60">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button Content="✕"
                                            Foreground="Red"
                                            Background="Transparent"
                                            BorderThickness="0"
                                            Click="RemoveItem_Click"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>

                <!-- Actions -->
                <StackPanel Orientation="Horizontal"
                            HorizontalAlignment="Left">

                    <Button Content="+ إضافة منتج"
                            Width="120"
                            Margin="0,0,12,0"
                            Click="AddItem_Click"/>

                    <Button Content="تأكيد الطلب"
                            Width="160"
                            Height="40"
                            Style="{StaticResource DarkButtonStyle}"
                            Click="ConfirmOrder_Click"/>
                </StackPanel>

            </StackPanel>
        </Border>
    </Grid>
</Page>
