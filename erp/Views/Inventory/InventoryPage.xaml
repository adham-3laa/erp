<Page x:Class="EduGate.Views.Inventory.InventoryPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="clr-namespace:EduGate.Views.Inventory"
      Background="Transparent">

    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- TopBar -->
            <RowDefinition Height="Auto"/>
            <!-- Error + Search -->
            <RowDefinition Height="*"/>
            <!-- DataGrid -->
            <RowDefinition Height="Auto"/>
            <!-- Pagination -->
        </Grid.RowDefinitions>

        <!-- ✅ TopBar ثابت -->
        <local:InventoryTopBar x:Name="InventoryTopBarControl" Grid.Row="0"/>

        <!-- رسالة الخطأ + Search bar + Refresh -->
        <StackPanel Grid.Row="1" Orientation="Vertical" Margin="0,10,0,10">
            <TextBlock x:Name="ErrorTextBlock"
                       Foreground="Red"
                       FontSize="14"
                       Visibility="Collapsed"
                       Margin="0,0,0,10"/>

            <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                <Border Style="{StaticResource GlowInputFrame}">
                    <Border Style="{StaticResource GlowInputInner}">
                        <Grid>
                            <TextBox x:Name="SearchTextBox"
                                     Style="{StaticResource GlowTextBox}"
                                     Width="200"
                                     TextChanged="SearchTextBox_TextChanged"/>
                            <TextBlock Text="ابحث بالـ ID"
                                       Foreground="Gray"
                                       Margin="5,0,0,0"
                                       VerticalAlignment="Center"
                                       IsHitTestVisible="False"
                                       Visibility="{Binding Text.IsEmpty,
                                       ElementName=SearchTextBox,
                                       Converter={StaticResource BoolToVisibilityConverter}}"/>
                        </Grid>
                    </Border>
                </Border>

                <Button Content="🔄"
                        Style="{StaticResource DarkButtonStyle}"
                        Width="60"
                        Margin="10,0,0,0"
                        Click="RefreshButton_Click"/>
            </StackPanel>
        </StackPanel>

        <!-- جدول المنتجات -->
        <Border Grid.Row="2" Style="{StaticResource CardStyle}">
            <DataGrid x:Name="ProductsDataGrid"
                      AutoGenerateColumns="False"
                      CanUserAddRows="False"
                      IsReadOnly="True"
                      HeadersVisibility="Column">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="ID" Binding="{Binding ProductId}" Width="*"/>
                    <DataGridTextColumn Header="اسم المنتج" Binding="{Binding Name}" Width="*"/>
                    <DataGridTextColumn Header="سعر البيع" Binding="{Binding SalePrice}" Width="*"/>
                    <DataGridTextColumn Header="سعر الشراء" Binding="{Binding BuyPrice}" Width="*"/>
                    <DataGridTextColumn Header="الكمية" Binding="{Binding Quantity}" Width="*"/>
                    <DataGridTextColumn Header="الصنف" Binding="{Binding Category}" Width="*"/>
                    <DataGridTextColumn Header="المورد" Binding="{Binding Supplier}" Width="*"/>

                    <!-- ✏️ تعديل -->
                    <DataGridTemplateColumn Header="تعديل">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Button Content="✏️"
                                        Width="40"
                                        Style="{StaticResource DarkButtonStyle}"
                                        Click="EditProduct_Click"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- 🗑 حذف -->
                    <DataGridTemplateColumn Header="حذف">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Button Content="🗑"
                                        Width="40"
                                        Style="{StaticResource DarkButtonStyle}"
                                        Click="DeleteProduct_Click"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Border>

        <!-- Pagination -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10,0,0">
            <Button Content="&lt;&lt;" Width="60" Click="FirstPage_Click"/>
            <Button Content="&lt;" Width="60" Margin="5,0" Click="PrevPage_Click"/>
            <TextBlock x:Name="PageTextBlock" VerticalAlignment="Center" Margin="5,0"/>
            <Button Content=">" Width="60" Margin="5,0" Click="NextPage_Click"/>
            <Button Content=">>" Width="60" Click="LastPage_Click"/>
        </StackPanel>
    </Grid>
</Page>
