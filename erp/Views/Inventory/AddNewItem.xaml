<Page x:Class="erp.Views.Inventory.AddNewItem"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Background="{StaticResource PageBgBrush}"
      FlowDirection="RightToLeft">

    <!-- ================= Resources ================= -->
    <Page.Resources>

        <DropShadowEffect x:Key="PrimaryOutlineGlow"
                          Color="{Binding Color, Source={StaticResource PrimaryBrush}}"
                          BlurRadius="18"
                          ShadowDepth="0"
                          Opacity="0.30"/>

        <!-- Card -->
        <Style x:Key="WizardCardStyle" TargetType="Border">
            <Setter Property="CornerRadius" Value="18"/>
            <Setter Property="Background" Value="{StaticResource CardBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{StaticResource SoftBorderBrush}"/>
            <Setter Property="Padding" Value="24"/>
            <Setter Property="Effect" Value="{StaticResource PrimaryOutlineGlow}"/>
        </Style>

        <!-- Field title -->
        <Style x:Key="FieldTitleStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="{StaticResource TextMutedBrush}"/>
            <Setter Property="Margin" Value="0,16,0,6"/>
        </Style>

        <!-- TextBox style (WPF safe) -->
        <Style x:Key="WizardTextBoxStyle" TargetType="TextBox">
            <Setter Property="Height" Value="38"/>
            <Setter Property="Padding" Value="10"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Background" Value="Transparent"/>
        </Style>

    </Page.Resources>

    <!-- ================= Layout ================= -->
    <Grid Margin="28" MinWidth="760">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- ================= Header ================= -->
        <Grid Grid.Row="0" Margin="0,0,0,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBlock Text="إضافة منتجات جديدة"
                       FontSize="28"
                       FontWeight="Bold"
                       Foreground="{StaticResource TextDarkBrush}"
                       VerticalAlignment="Center"/>

            <Button Grid.Column="2"
                    Content="رجوع"
                    Width="120"
                    Height="40"
                    Style="{StaticResource DarkButtonStyle}"
                    Click="Back_Click"/>
        </Grid>

        <!-- ================= Wizard Card ================= -->
        <Border Grid.Row="1"
                Style="{StaticResource WizardCardStyle}"
                Width="780"
                HorizontalAlignment="Center">

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- ================= Steps ================= -->
                <Grid Grid.Row="0">

                    <!-- STEP 1 : Intro -->
                    <StackPanel x:Name="IntroPanel"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Width="420">

                        <Button Content="ابدأ بإدخال عدد المنتجات"
                                Height="46"
                                FontSize="15"
                                Style="{StaticResource DarkButtonStyle}"
                                Click="ShowCount_Click"/>
                    </StackPanel>

                    <!-- STEP 2 : Supplier + Count -->
                    <StackPanel x:Name="CountPanel"
                                Visibility="Collapsed"
                                Width="520"
                                HorizontalAlignment="Center">

                        <TextBlock Text="الخطوة 1 من 2"
                                   Foreground="{StaticResource PrimaryBrush}"
                                   FontWeight="Bold"/>

                        <TextBlock Text="بيانات المورد وعدد المنتجات"
                                   FontSize="20"
                                   FontWeight="Bold"
                                   Margin="0,6,0,20"/>

                        <TextBlock Text="اسم المورد" Style="{StaticResource FieldTitleStyle}"/>
                        <Grid>
                            <Border CornerRadius="10"
                                    BorderThickness="1"
                                    BorderBrush="{StaticResource SoftBorderBrush}">
                                <TextBox x:Name="SupplierNameTextBox"
                                         Style="{StaticResource WizardTextBoxStyle}"
                                         TextChanged="SupplierNameTextBox_TextChanged"
                                         GotFocus="SupplierNameTextBox_GotFocus"
                                         LostFocus="SupplierNameTextBox_LostFocus"
                                         KeyDown="SupplierNameTextBox_KeyDown"/>
                            </Border>

                            <!-- Suggestions Popup for Supplier -->
                            <Border x:Name="SupplierSuggestionsBorder"
                                    Background="White"
                                    CornerRadius="8"
                                    BorderBrush="#DDD"
                                    BorderThickness="1"
                                    Margin="0,42,0,0"
                                    Visibility="Collapsed"
                                    MaxHeight="200">
                                <Border.Effect>
                                    <DropShadowEffect Color="#40000000"
                                                      BlurRadius="8"
                                                      ShadowDepth="2"
                                                      Opacity="0.3"/>
                                </Border.Effect>
                                <ListBox x:Name="SupplierSuggestionsListBox"
                                         BorderThickness="0"
                                         SelectionChanged="SupplierSuggestionsListBox_SelectionChanged"
                                         MouseLeftButtonUp="SupplierSuggestionsListBox_MouseLeftButtonUp"
                                         PreviewMouseDown="SupplierSuggestionsListBox_PreviewMouseDown">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Padding="10"
                                                       Cursor="Hand"
                                                       Text="{Binding}"/>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                            </Border>
                        </Grid>

                        <TextBlock Text="عدد المنتجات" Style="{StaticResource FieldTitleStyle}"/>
                        <Border CornerRadius="10"
                                BorderThickness="1"
                                BorderBrush="{StaticResource SoftBorderBrush}">
                            <TextBox x:Name="CountTextBox"
                                     Style="{StaticResource WizardTextBoxStyle}"
                                     FlowDirection="LeftToRight"
                                     TextAlignment="Center"/>
                        </Border>

                        <Button Content="ابدأ إدخال المنتجات"
                                Margin="0,30,0,0"
                                Height="44"
                                Style="{StaticResource DarkButtonStyle}"
                                Click="StartWizard_Click"/>
                    </StackPanel>

                    <!-- STEP 3 : Product Form -->
                    <StackPanel x:Name="FormPanel"
                                Visibility="Collapsed"
                                Width="620"
                                HorizontalAlignment="Center">

                        <TextBlock x:Name="StepTitle"
                                   FontSize="20"
                                   FontWeight="Bold"
                                   Margin="0,0,0,16"/>

                        <TextBlock Text="اسم المنتج" Style="{StaticResource FieldTitleStyle}"/>
                        <Border CornerRadius="10"
                                BorderThickness="1"
                                BorderBrush="{StaticResource SoftBorderBrush}">
                            <TextBox Text="{Binding Name}"
                                     Style="{StaticResource WizardTextBoxStyle}"/>
                        </Border>

                        <TextBlock Text="SKU" Style="{StaticResource FieldTitleStyle}"/>
                        <Border CornerRadius="10"
                                BorderThickness="1"
                                BorderBrush="{StaticResource SoftBorderBrush}">
                            <TextBox Text="{Binding SKU}"
                                     Style="{StaticResource WizardTextBoxStyle}"/>
                        </Border>

                        <Grid Margin="0,16,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Margin="0,0,12,0">
                                <TextBlock Text="سعر البيع" Style="{StaticResource FieldTitleStyle}"/>
                                <Border CornerRadius="10"
                                        BorderThickness="1"
                                        BorderBrush="{StaticResource SoftBorderBrush}">
                                    <TextBox Text="{Binding SalePrice}"
                                             Style="{StaticResource WizardTextBoxStyle}"
                                             FlowDirection="LeftToRight"/>
                                </Border>
                            </StackPanel>

                            <StackPanel Grid.Column="1">
                                <TextBlock Text="سعر الشراء" Style="{StaticResource FieldTitleStyle}"/>
                                <Border CornerRadius="10"
                                        BorderThickness="1"
                                        BorderBrush="{StaticResource SoftBorderBrush}">
                                    <TextBox Text="{Binding BuyPrice}"
                                             Style="{StaticResource WizardTextBoxStyle}"
                                             FlowDirection="LeftToRight"/>
                                </Border>
                            </StackPanel>
                        </Grid>

                        <TextBlock Text="الكمية" Style="{StaticResource FieldTitleStyle}"/>
                        <Border CornerRadius="10"
                                BorderThickness="1"
                                BorderBrush="{StaticResource SoftBorderBrush}">
                            <TextBox Text="{Binding Quantity}"
                                     Style="{StaticResource WizardTextBoxStyle}"
                                     FlowDirection="LeftToRight"/>
                        </Border>

                        <TextBlock Text="الصنف" Style="{StaticResource FieldTitleStyle}"/>
                        <Grid>
                            <Border CornerRadius="10"
                                    BorderThickness="1"
                                    BorderBrush="{StaticResource SoftBorderBrush}">
                                <TextBox x:Name="CategoryTextBox"
                                         Text="{Binding Category, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource WizardTextBoxStyle}"
                                         TextChanged="CategoryTextBox_TextChanged"
                                         GotFocus="CategoryTextBox_GotFocus"
                                         LostFocus="CategoryTextBox_LostFocus"
                                         KeyDown="CategoryTextBox_KeyDown"/>
                            </Border>

                            <!-- Suggestions Popup -->
                            <Border x:Name="SuggestionsBorder"
                                    Background="White"
                                    CornerRadius="8"
                                    BorderBrush="#DDD"
                                    BorderThickness="1"
                                    Margin="0,42,0,0"
                                    Visibility="Collapsed"
                                    MaxHeight="200">
                                <Border.Effect>
                                    <DropShadowEffect Color="#40000000"
                                                      BlurRadius="8"
                                                      ShadowDepth="2"
                                                      Opacity="0.3"/>
                                </Border.Effect>
                                <ListBox x:Name="SuggestionsListBox"
                                         BorderThickness="0"
                                         SelectionChanged="SuggestionsListBox_SelectionChanged"
                                         MouseLeftButtonUp="SuggestionsListBox_MouseLeftButtonUp"
                                         PreviewMouseDown="SuggestionsListBox_PreviewMouseDown">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Padding="10"
                                                       Cursor="Hand"
                                                       Text="{Binding}"/>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                            </Border>
                        </Grid>

                        <TextBlock Text="الوصف" Style="{StaticResource FieldTitleStyle}"/>
                        <Border CornerRadius="10"
                                BorderThickness="1"
                                BorderBrush="{StaticResource SoftBorderBrush}">
                            <TextBox Text="{Binding Description}"
                                     Height="90"
                                     AcceptsReturn="True"
                                     TextWrapping="Wrap"
                                     Style="{StaticResource WizardTextBoxStyle}"/>
                        </Border>
                    </StackPanel>
                </Grid>

                <!-- ================= Actions ================= -->
                <StackPanel Grid.Row="1"
                            Orientation="Horizontal"
                            HorizontalAlignment="Left"
                            Margin="0,24,0,0">

                    <Button Content="رجوع"
                            Width="120"
                            Height="40"
                            Margin="0,0,12,0"
                            Style="{StaticResource DarkButtonStyle}"
                            Click="Prev_Click"/>

                    <Button x:Name="NextBtn"
                            Content="التالي"
                            Width="120"
                            Height="40"
                            Style="{StaticResource DarkButtonStyle}"
                            Click="Next_Click"/>

                    <Button x:Name="SaveBtn"
                            Content="حفظ"
                            Width="120"
                            Height="40"
                            Margin="12,0,0,0"
                            Visibility="Collapsed"
                            Style="{StaticResource DarkButtonStyle}"
                            Click="Save_Click"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Page>
