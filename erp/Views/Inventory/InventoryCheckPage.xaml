<Page x:Class="erp.Views.Inventory.InventoryCheckPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Background="{StaticResource PageBgBrush}"
      FlowDirection="RightToLeft">

    <!-- ================= Resources ================= -->
    <Page.Resources>

        <DropShadowEffect x:Key="PrimaryOutlineGlow"
                          Color="{Binding Color, Source={StaticResource PrimaryBrush}}"
                          BlurRadius="18"
                          ShadowDepth="0"
                          Opacity="0.30"/>

        <!-- Main Card -->
        <Style x:Key="AuditCardStyle" TargetType="Border">
            <Setter Property="CornerRadius" Value="18"/>
            <Setter Property="Background" Value="{StaticResource CardBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{StaticResource SoftBorderBrush}"/>
            <Setter Property="Padding" Value="24"/>
            <Setter Property="Effect" Value="{StaticResource PrimaryOutlineGlow}"/>
        </Style>

        <!-- Result Card -->
        <Style x:Key="ResultCardStyle" TargetType="Border">
            <Setter Property="CornerRadius" Value="14"/>
            <Setter Property="Background" Value="{StaticResource CardBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{StaticResource PrimaryBrush}"/>
            <Setter Property="Padding" Value="18"/>
        </Style>

        <!-- Field title -->
        <Style x:Key="FieldTitleStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="{StaticResource TextMutedBrush}"/>
            <Setter Property="Margin" Value="0,18,0,6"/>
        </Style>

        <!-- TextBox (safe) -->
        <Style x:Key="AuditTextBoxStyle" TargetType="TextBox">
            <Setter Property="Height" Value="38"/>
            <Setter Property="Padding" Value="10"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Background" Value="Transparent"/>
        </Style>

    </Page.Resources>

    <!-- ================= Layout ================= -->
    <Grid Margin="28">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- ================= Header ================= -->
        <Grid Grid.Row="0" Margin="0,0,0,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Button Content="⬅ رجوع"
                    Width="110"
                    Height="40"
                    Style="{StaticResource DarkButtonStyle}"
                    Click="Back_Click"/>

            <TextBlock Grid.Column="1"
                       Text="جرد المخزون"
                       FontSize="28"
                       FontWeight="Bold"
                       Foreground="{StaticResource TextDarkBrush}"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center"/>
        </Grid>

        <!-- ================= Audit Form ================= -->
        <Border Grid.Row="1"
                Style="{StaticResource AuditCardStyle}"
                Width="700"
                HorizontalAlignment="Center"
                VerticalAlignment="Center">

            <StackPanel>

                <!-- Section: Product Info -->
                <TextBlock Text="بيانات المنتج"
                           FontSize="18"
                           FontWeight="Bold"
                           Margin="0,0,0,12"/>

                <TextBlock Text="اسم المنتج" Style="{StaticResource FieldTitleStyle}"/>
                <Grid>
                    <Border CornerRadius="10"
                            BorderThickness="1"
                            BorderBrush="{StaticResource SoftBorderBrush}">
                        <TextBox x:Name="ProductNameTextBox"
                                 Style="{StaticResource AuditTextBoxStyle}"
                                 TextChanged="ProductNameTextBox_TextChanged"
                                 GotFocus="ProductNameTextBox_GotFocus"
                                 LostFocus="ProductNameTextBox_LostFocus"
                                 KeyDown="ProductNameTextBox_KeyDown"/>
                    </Border>

                    <!-- Suggestions Popup for Product -->
                    <Border x:Name="ProductSuggestionsBorder"
                            Background="White"
                            CornerRadius="8"
                            BorderBrush="#DDD"
                            BorderThickness="1"
                            Margin="0,42,0,0"
                            Visibility="Collapsed"
                            MaxHeight="200">
                        <Border.Effect>
                            <DropShadowEffect Color="#40000000"
                                              BlurRadius="8"
                                              ShadowDepth="2"
                                              Opacity="0.3"/>
                        </Border.Effect>
                        <ListBox x:Name="ProductSuggestionsListBox"
                                 BorderThickness="0"
                                 SelectionChanged="ProductSuggestionsListBox_SelectionChanged"
                                 MouseLeftButtonUp="ProductSuggestionsListBox_MouseLeftButtonUp"
                                 PreviewMouseDown="ProductSuggestionsListBox_PreviewMouseDown">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Padding="10"
                                               Cursor="Hand"
                                               Text="{Binding}"/>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Border>
                </Grid>

                <TextBlock Text="الكمية الفعلية" Style="{StaticResource FieldTitleStyle}"/>
                <Border CornerRadius="10"
                        BorderThickness="1"
                        BorderBrush="{StaticResource SoftBorderBrush}">
                    <TextBox x:Name="ActualQuantityTextBox"
                             Style="{StaticResource AuditTextBoxStyle}"
                             FlowDirection="LeftToRight"/>
                </Border>

                <!-- Section: Options -->
                <TextBlock Text="إعدادات الجرد"
                           FontSize="18"
                           FontWeight="Bold"
                           Margin="0,28,0,12"/>

                <TextBlock Text="هل تريد تحديث الكمية في المخزون؟"
                           FontWeight="SemiBold"
                           Margin="0,0,0,10"/>

                <StackPanel Orientation="Horizontal" Margin="0,0,0,24">
                    <RadioButton x:Name="UpdateYesRadio"
                                 Content="نعم"
                                 FontWeight="Bold"
                                 IsChecked="True"
                                 Margin="0,0,24,0"/>
                    <RadioButton x:Name="UpdateNoRadio"
                                 Content="لا"
                                 FontWeight="Bold"/>
                </StackPanel>

                <!-- Execute -->
                <Button Content="تنفيذ الجرد"
                        Width="180"
                        Height="44"
                        Style="{StaticResource DarkButtonStyle}"
                        HorizontalAlignment="Left"
                        Click="Adjust_Click"/>

                <!-- ================= Result ================= -->
                <Border x:Name="ResultCard"
                        Visibility="Collapsed"
                        Margin="0,32,0,0"
                        Style="{StaticResource ResultCardStyle}">

                    <StackPanel>

                        <TextBlock x:Name="ResultTitleText"
                                   FontSize="20"
                                   FontWeight="Bold"
                                   Foreground="{StaticResource PrimaryBrush}"
                                   Margin="0,0,0,10"/>

                        <TextBlock x:Name="ResultMessageText"
                                   FontSize="14"
                                   Margin="0,0,0,10"/>

                        <TextBlock x:Name="OldQuantityText"
                                   FontSize="13"/>

                        <TextBlock x:Name="NewQuantityText"
                                   FontSize="13"/>

                        <TextBlock x:Name="FinancialImpactText"
                                   FontSize="13"
                                   Margin="0,10,0,0"/>
                    </StackPanel>
                </Border>

            </StackPanel>
        </Border>

    </Grid>
</Page>
