<Page x:Class="erp.Views.Category.CategoryListPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:vm="clr-namespace:erp.ViewModels.CategoryView"
      Background="{StaticResource PageBgBrush}"
      FlowDirection="RightToLeft">

    <Page.DataContext>
        <vm:CategoryListViewModel/>
    </Page.DataContext>

    <Grid Margin="20">
        <Border Style="{StaticResource CardStyle}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Header -->
                <DockPanel Grid.Row="0" Margin="0,0,0,12">
                    <TextBlock Text="الأصناف           "
                               FontSize="20"
                               FontWeight="Bold"
                               Foreground="{StaticResource PrimaryBrush}"
                               DockPanel.Dock="Left"/>

                    <StackPanel Orientation="Horizontal" DockPanel.Dock="Right">
                        <Button Style="{StaticResource DarkButtonStyle}"
                                Content="➕ إضافة"
                                Margin="6,0"
                                Click="Add_Click"/>

                        <Button Style="{StaticResource DarkButtonStyle}"
                                Content="✏️ تعديل المحدد"
                                Margin="6,0"
                                Click="Edit_Click"/>

                        <Button Style="{StaticResource DarkButtonStyle}"
                                Content="تحديث"
                                Margin="6,0"
                                Command="{Binding RefreshCommand}"/>

                        <Button Style="{StaticResource DarkButtonStyle}"
                                Content="حذف المحدد"
                                Margin="6,0"
                                Command="{Binding DeleteSelectedCommand}"/>
                    </StackPanel>
                </DockPanel>

                <!-- Error -->
                <Border Grid.Row="1"
                     Margin="0,0,0,10"
                     CornerRadius="14"
                     Background="#FFFEE2E2"
                     BorderBrush="#FFFCA5A5"
                     BorderThickness="1"
                     Padding="12"
                     Visibility="{Binding Error, Converter={StaticResource StringNotEmptyToVisibilityConverter}}">
                    <DockPanel>
                        <TextBlock Text="⚠️" FontSize="16" Margin="0,0,10,0"/>
                        <TextBlock Text="{Binding Error}"
                   Foreground="#991B1B"
                   FontWeight="SemiBold"
                   TextWrapping="Wrap"/>
                    </DockPanel>
                </Border>

                <!-- Table -->
                 <DataGrid Grid.Row="2"
                           Style="{StaticResource ProDataGridStyle}"
                           ColumnHeaderStyle="{StaticResource ProDataGridHeaderStyle}"
                           RowStyle="{StaticResource ProDataGridRowStyle}"
                           CellStyle="{StaticResource ProDataGridCellStyle}"
                           ItemsSource="{Binding Items}"
                           SelectedItem="{Binding Selected}">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="الكود" Binding="{Binding Id}" Width="2*"/>
                        <DataGridTextColumn Header="الاسم" Binding="{Binding Name}" Width="2*"/>
                        <DataGridTextColumn Header="الوصف" Binding="{Binding Description}" Width="3*"/>
                    </DataGrid.Columns>
                 </DataGrid>

            </Grid>
        </Border>
    </Grid>
</Page>
