<Page x:Class="erp.Views.Cheques.ChequesListPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:local="clr-namespace:erp.Views.Cheques"
      xmlns:converters="clr-namespace:erp.Converters"
      mc:Ignorable="d"
      Title="ChequesListPage"
      FlowDirection="RightToLeft"
      Background="#F3F4F6">

    <Page.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <converters:BooleanToTextConverter x:Key="BooleanToTextConverter"/>
        <converters:ChequeStatusToColorConverter x:Key="ChequeStatusToColorConverter"/>
        <converters:ChequeDirectionConverter x:Key="ChequeDirectionConverter"/>
        <converters:OverdueToColorConverter x:Key="OverdueToColorConverter"/>
        <converters:CollectionCountToVisibilityConverter x:Key="CountToVisibilityConverter"/>

        <Style TargetType="Button" x:Key="ActionBtn" BasedOn="{StaticResource {x:Type Button}}">
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>
    </Page.Resources>

    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Header -->
            <RowDefinition Height="Auto"/> <!-- Filters -->
            <RowDefinition Height="*"/>    <!-- Content Area -->
        </Grid.RowDefinitions>

        <!-- Header Section -->
        <Grid Grid.Row="0" Margin="0,0,0,24">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <!-- Add Cheque Button - Left Side (appears on right in RTL) -->
            <Button Grid.Column="0" 
                    Content="+ Ø¥Ø¶Ø§ÙØ© Ø´ÙŠÙƒ Ø¬Ø¯ÙŠØ¯"
                    Background="#2563EB"
                    Foreground="White"
                    FontSize="14"
                    FontWeight="SemiBold"
                    Padding="20,10"
                    VerticalAlignment="Center"
                    Click="AddCheque_Click">
                <Button.Resources>
                    <Style TargetType="Border">
                        <Setter Property="CornerRadius" Value="8"/>
                    </Style>
                </Button.Resources>
            </Button>
            
            <!-- Title - Right Side (appears on left in RTL) -->
            <StackPanel Grid.Column="1" Orientation="Vertical" Margin="20,0,0,0">
                <TextBlock Text="Ø³Ø¬Ù„ Ø§Ù„Ø´ÙŠÙƒØ§Øª" FontSize="32" FontWeight="Bold" Foreground="#1F2937"/>
                <TextBlock Text="ØªØªØ¨Ø¹ Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ù…Ø§Ù„ÙŠØ© ÙˆØ§Ù„Ø´ÙŠÙƒØ§Øª Ø§Ù„ØµØ§Ø¯Ø±Ø© ÙˆØ§Ù„ÙˆØ§Ø±Ø¯Ø©" FontSize="14" Foreground="#6B7280" Margin="0,4,0,0"/>
            </StackPanel>
        </Grid>

        <!-- Dynamic Filter Panel -->
        <Border Grid.Row="1" Background="White" CornerRadius="12" Padding="20" Margin="0,0,0,24" BorderBrush="#F3F4F6" BorderThickness="1">
            <Border.Effect>
                <DropShadowEffect BlurRadius="15" ShadowDepth="1" Opacity="0.05"/>
            </Border.Effect>
            <WrapPanel Orientation="Horizontal">
                <!-- Search -->
                <StackPanel Margin="0,0,20,10">
                    <TextBlock Text="Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø± (Ø¹Ù…ÙŠÙ„/Ù…ÙˆØ±Ø¯)" FontSize="12" FontWeight="Medium" Foreground="#374151" Margin="0,0,0,6"/>
                    <TextBox Width="220" Height="36" Padding="8,4" VerticalContentAlignment="Center"
                             Text="{Binding SearchName, UpdateSourceTrigger=PropertyChanged}" 
                             Tag="Search here..."/>
                </StackPanel>

                <!-- Type -->
                <StackPanel Margin="0,0,20,10">
                    <TextBlock Text="Ù†ÙˆØ¹ Ø§Ù„Ø­Ø±ÙƒØ©" FontSize="12" FontWeight="Medium" Foreground="#374151" Margin="0,0,0,6"/>
                    <ComboBox Width="160" Height="36" SelectedValuePath="Tag" 
                              SelectedValue="{Binding SelectedDirection, UpdateSourceTrigger=PropertyChanged}">
                        <ComboBoxItem Content="Ø§Ù„ÙƒÙ„" Tag=""/>
                        <ComboBoxItem Content="ÙˆØ§Ø±Ø¯ (Ù…Ù‚Ø¨ÙˆØ¶Ø§Øª)" Tag="Incoming"/>
                        <ComboBoxItem Content="ØµØ§Ø¯Ø± (Ù…Ø¯ÙÙˆØ¹Ø§Øª)" Tag="Outgoing"/>
                    </ComboBox>
                </StackPanel>

                <!-- Status -->
                <StackPanel Margin="0,0,20,10">
                    <TextBlock Text="Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©" FontSize="12" FontWeight="Medium" Foreground="#374151" Margin="0,0,0,6"/>
                    <ComboBox Width="160" Height="36" SelectedValuePath="Tag" 
                              SelectedValue="{Binding SelectedStatus, UpdateSourceTrigger=PropertyChanged}">
                        <ComboBoxItem Content="Ø§Ù„ÙƒÙ„" Tag=""/>
                        <ComboBoxItem Content="Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±" Tag="Pending"/>
                        <ComboBoxItem Content="ØªÙ… Ø§Ù„ØªØ­ØµÙŠÙ„" Tag="Collected"/>
                        <ComboBoxItem Content="Ù…Ø±ÙÙˆØ¶ / Ù…Ø±ØªØ¯" Tag="Rejected"/>
                        <ComboBoxItem Content="Ù…Ù„ØºÙ‰" Tag="Cancelled"/>
                    </ComboBox>
                </StackPanel>

                <!-- From Date -->
                <StackPanel Margin="0,0,20,10">
                    <TextBlock Text="Ù…Ù† ØªØ§Ø±ÙŠØ®" FontSize="12" FontWeight="Medium" Foreground="#374151" Margin="0,0,0,6"/>
                    <DatePicker Width="140" Height="36" SelectedDate="{Binding StartDate}"/>
                </StackPanel>

                <!-- To Date -->
                <StackPanel Margin="0,0,20,10">
                    <TextBlock Text="Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®" FontSize="12" FontWeight="Medium" Foreground="#374151" Margin="0,0,0,6"/>
                    <DatePicker Width="140" Height="36" SelectedDate="{Binding EndDate}"/>
                </StackPanel>
            </WrapPanel>
        </Border>

        <!-- Main Content Area -->
        <Grid Grid.Row="2">
            <!-- Loading Indicator -->
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" 
                        Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}" Panel.ZIndex="10">
                <ProgressBar IsIndeterminate="True" Width="200" Height="4" Foreground="#2563EB"/>
                <TextBlock Text="Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª..." Margin="0,10" HorizontalAlignment="Center" Foreground="#6B7280"/>
            </StackPanel>

            <!-- Empty State -->
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center"
                        Visibility="{Binding Cheques.Count, Converter={StaticResource CountToVisibilityConverter}}">
                <TextBlock Text="ðŸ“’" FontSize="64" HorizontalAlignment="Center"/>
                <TextBlock Text="Ù„Ø§ ØªÙˆØ¬Ø¯ Ø´ÙŠÙƒØ§Øª ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø¨Ø­Ø«" FontSize="18" FontWeight="SemiBold" Foreground="#4B5563" Margin="0,10"/>
                <TextBlock Text="Ø­Ø§ÙˆÙ„ ØªØºÙŠÙŠØ± Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø« Ø£Ùˆ Ø¥Ø¶Ø§ÙØ© Ø´ÙŠÙƒ Ø¬Ø¯ÙŠØ¯" Foreground="#9CA3AF"/>
            </StackPanel>

            <!-- Modern DataGrid -->
            <Border Background="White" CornerRadius="12" BorderBrush="#F3F4F6" BorderThickness="1" ClipToBounds="True">
                <DataGrid ItemsSource="{Binding Cheques}" 
                          AutoGenerateColumns="False" 
                          CanUserAddRows="False"
                          HeadersVisibility="Column"
                          GridLinesVisibility="None"
                          Background="White"
                          BorderThickness="0"
                          IsReadOnly="True"
                          RowHeight="52"
                          SelectionMode="Single"
                          AlternatingRowBackground="#F9FAFB">
                    
                    <DataGrid.CellStyle>
                        <Style TargetType="DataGridCell">
                            <Setter Property="Padding" Value="10,0"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="DataGridCell">
                                        <Border Padding="{TemplateBinding Padding}" Background="{TemplateBinding Background}">
                                            <ContentPresenter VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="#EFF6FF"/>
                                    <Setter Property="Foreground" Value="#1E40AF"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </DataGrid.CellStyle>

                    <DataGrid.Columns>
                        <!-- Type Icon & Label -->
                        <DataGridTemplateColumn Header="Ø§Ù„Ù†ÙˆØ¹" Width="120">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                        <TextBlock Text="{Binding IsIncoming, Converter={StaticResource ChequeDirectionConverter}, ConverterParameter=Icon}" 
                                                   Margin="0,0,8,0" VerticalAlignment="Center"/>
                                        <TextBlock Text="{Binding IsIncoming, Converter={StaticResource ChequeDirectionConverter}}" 
                                                   FontSize="12" VerticalAlignment="Center" FontWeight="Medium"/>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <DataGridTextColumn Header="Ø±Ù‚Ù… Ø§Ù„Ø´ÙŠÙƒ" Binding="{Binding CheckNumber}" Width="120"/>
                        <DataGridTextColumn Header="Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø±" Binding="{Binding RelatedName}" Width="*"/>
                        <DataGridTextColumn Header="Ø§Ù„Ø¨Ù†Ùƒ" Binding="{Binding BankName}" Width="140"/>

                        <!-- Amount with Formatting -->
                        <DataGridTemplateColumn Header="Ø§Ù„Ù…Ø¨Ù„Øº" Width="120">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Amount, StringFormat='#,##0.00 EGP'}" 
                                               FontWeight="Bold" Foreground="#111827" HorizontalAlignment="Right"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <!-- Due Date with Overdue Highlight -->
                        <DataGridTemplateColumn Header="ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚" Width="130">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Border Background="{Binding DueDate, Converter={StaticResource OverdueToColorConverter}}" CornerRadius="4" Padding="6,2">
                                        <TextBlock Text="{Binding DueDate, StringFormat=dd/MM/yyyy}" 
                                                   HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <!-- Status Badge -->
                        <DataGridTemplateColumn Header="Ø§Ù„Ø­Ø§Ù„Ø©" Width="110">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Border CornerRadius="12" Padding="10,4" HorizontalAlignment="Center"
                                            Background="{Binding Status, Converter={StaticResource ChequeStatusToColorConverter}}">
                                        <TextBlock Text="{Binding Status}" FontWeight="Bold" FontSize="11"
                                                   Foreground="{Binding Status, Converter={StaticResource ChequeStatusToColorConverter}, ConverterParameter=Foreground}"/>
                                    </Border>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <!-- Actions Area - Status Updates Only -->
                        <DataGridTemplateColumn Header="ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©" Width="120">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                        <Button Content="âœ…" ToolTip="ØªÙ… Ø§Ù„ØªØ­ØµÙŠÙ„" Style="{StaticResource ActionBtn}" Click="Accept_Click" Tag="{Binding}" FontSize="16"/>
                                        <Separator Width="1" Height="20" Background="#E5E7EB" Margin="6,0"/>
                                        <Button Content="âŒ" ToolTip="Ø±ÙØ¶ / Ø§Ø±ØªØ¯Ø§Ø¯" Style="{StaticResource ActionBtn}" Click="Reject_Click" Tag="{Binding}" FontSize="16"/>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                    </DataGrid.Columns>
                </DataGrid>
            </Border>
        </Grid>
    </Grid>
</Page>
