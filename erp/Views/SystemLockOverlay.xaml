<Window x:Class="erp.Views.SystemLockOverlay"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="System Locked"
        WindowStyle="None"
        WindowState="Maximized"
        ResizeMode="NoResize"
        Topmost="True"
        AllowsTransparency="True"
        Background="Transparent"
        ShowInTaskbar="False"
        Loaded="Window_Loaded">

    <Window.Resources>
        <!-- Modern Button Style -->
        <Style x:Key="ModernButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#0078D4"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Height" Value="45"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="6"
                                BorderThickness="0">
                            <ContentPresenter HorizontalAlignment="Center"
                                            VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#005A9E"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Background" Value="#CCCCCC"/>
                    <Setter Property="Cursor" Value="Arrow"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Modern PasswordBox Style -->
        <Style x:Key="ModernPasswordBoxStyle" TargetType="PasswordBox">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="Height" Value="45"/>
            <Setter Property="Padding" Value="12,10"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#CCCCCC"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="PasswordBox">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="6">
                            <ScrollViewer x:Name="PART_ContentHost"
                                        Margin="{TemplateBinding Padding}"
                                        VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsFocused" Value="True">
                    <Setter Property="BorderBrush" Value="#0078D4"/>
                    <Setter Property="BorderThickness" Value="2"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <!-- Full Screen Overlay -->
    <Grid>
        <!-- Darkened/Blurred Background -->
        <Border Background="#DD000000">
            <!-- Blur effect -->
            <Border.Effect>
                <BlurEffect Radius="5"/>
            </Border.Effect>
        </Border>

        <!-- Lock Icon Background Pattern (Subtle) -->
        <Viewbox Width="400" Height="400" Opacity="0.03">
            <Path Data="M12,17A2,2 0 0,0 14,15C14,13.89 13.1,13 12,13A2,2 0 0,0 10,15A2,2 0 0,0 12,17M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V10C4,8.89 4.9,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z"
                  Fill="White"
                  Stretch="Uniform"/>
        </Viewbox>

        <!-- Center Lock Card -->
        <Border Width="450"
                Height="Auto"
                Background="White"
                CornerRadius="12"
                Padding="40"
                VerticalAlignment="Center"
                HorizontalAlignment="Center">
            <Border.Effect>
                <DropShadowEffect Color="Black" 
                                Direction="270" 
                                ShadowDepth="3" 
                                BlurRadius="20" 
                                Opacity="0.3"/>
            </Border.Effect>

            <StackPanel>
                <!-- Lock Icon -->
                <Viewbox Width="80" Height="80" Margin="0,0,0,24">
                    <Path Data="M12,17A2,2 0 0,0 14,15C14,13.89 13.1,13 12,13A2,2 0 0,0 10,15A2,2 0 0,0 12,17M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V10C4,8.89 4.9,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z"
                          Fill="#D32F2F"
                          Stretch="Uniform"/>
                </Viewbox>

                <!-- Title -->
                <TextBlock Text="النظام مقفل"
                          FontSize="28"
                          FontWeight="Bold"
                          Foreground="#212121"
                          TextAlignment="Center"
                          Margin="0,0,0,12"/>

                <!-- Message -->
                <TextBlock Text="أدخل كلمة المرور للمتابعة"
                          FontSize="16"
                          Foreground="#666666"
                          TextAlignment="Center"
                          Margin="0,0,0,32"
                          TextWrapping="Wrap"
                          Visibility="{Binding IsPermanentlyLocked, Converter={StaticResource InverseBooleanToVisibilityConverter}}"/>

                <!-- Permanent Lock Message -->
                <TextBlock Text="{Binding PermanentLockMessage}"
                          FontSize="14"
                          FontWeight="Bold"
                          Foreground="#D32F2F"
                          TextAlignment="Center"
                          Margin="0,0,0,32"
                          TextWrapping="Wrap"
                          Visibility="{Binding IsPermanentlyLocked, Converter={StaticResource BoolToVisibilityConverter}}"/>

                <!-- Password Input -->
                <PasswordBox x:Name="PasswordBox"
                            Style="{StaticResource ModernPasswordBoxStyle}"
                            Margin="0,0,0,8"
                            KeyDown="PasswordBox_KeyDown"
                            IsEnabled="{Binding IsPermanentlyLocked, Converter={StaticResource InverseBooleanConverter}}"/>

                <!-- Error Message -->
                <TextBlock Text="{Binding ErrorMessage}"
                          Foreground="#D32F2F"
                          FontSize="14"
                          TextAlignment="Center"
                          Margin="0,0,0,16"
                          Visibility="{Binding HasError, Converter={StaticResource BoolToVisibilityConverter}}"
                          TextWrapping="Wrap"/>

                <!-- Unlock Button -->
                <Button Content="فتح النظام"
                       Style="{StaticResource ModernButtonStyle}"
                       Command="{Binding UnlockCommand}"
                       IsEnabled="{Binding IsProcessing, Converter={StaticResource InverseBooleanConverter}}"
                       Click="UnlockButton_Click"
                       Visibility="{Binding IsPermanentlyLocked, Converter={StaticResource InverseBooleanToVisibilityConverter}}"/>

                <!-- Processing Indicator -->
                <StackPanel Orientation="Horizontal"
                           HorizontalAlignment="Center"
                           Margin="0,16,0,0"
                           Visibility="{Binding IsProcessing, Converter={StaticResource BoolToVisibilityConverter}}">
                    <TextBlock Text="جاري المعالجة..."
                              FontSize="14"
                              Foreground="#666666"
                              Margin="0,0,8,0"/>
                    <!-- Simple loading indicator -->
                    <TextBlock Text="●" FontSize="14" Foreground="#0078D4">
                        <TextBlock.RenderTransform>
                            <RotateTransform Angle="0" CenterX="5" CenterY="5"/>
                        </TextBlock.RenderTransform>
                        <TextBlock.Triggers>
                            <EventTrigger RoutedEvent="Loaded">
                                <BeginStoryboard>
                                    <Storyboard RepeatBehavior="Forever">
                                        <DoubleAnimation Storyboard.TargetProperty="RenderTransform.Angle"
                                                       From="0" To="360" Duration="0:0:1"/>
                                    </Storyboard>
                                </BeginStoryboard>
                            </EventTrigger>
                        </TextBlock.Triggers>
                    </TextBlock>
                </StackPanel>

                <!-- Remaining Attempts Info -->
                <TextBlock Text="{Binding RemainingAttemptsText}"
                          FontSize="12"
                          Foreground="#FF9800"
                          FontWeight="SemiBold"
                          TextAlignment="Center"
                          Margin="0,24,0,0"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>
