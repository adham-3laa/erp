<Page x:Class="erp.Views.Invoices.InvoiceDetailsPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Background="{StaticResource PageBgBrush}"
      FlowDirection="RightToLeft">

    <Page.Resources>

        <!-- ===== Glow (our old frame) ===== -->
        <DropShadowEffect x:Key="PrimaryOutlineGlow"
                          Color="{Binding Color, Source={StaticResource PrimaryBrush}}"
                          BlurRadius="16"
                          ShadowDepth="0"
                          Opacity="0.35"/>

        <!-- ===== Old Frame (our design) ===== -->
        <Style x:Key="GlowingTableOuterBorder" TargetType="Border">
            <Setter Property="CornerRadius" Value="16"/>
            <Setter Property="Background" Value="{StaticResource CardBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{StaticResource PrimaryBrush}"/>
            <Setter Property="Padding" Value="12"/>
            <Setter Property="Effect" Value="{StaticResource PrimaryOutlineGlow}"/>
        </Style>

        <!-- ================= DataGrid Styles (our reference) ================= -->

        <Style x:Key="NiceDataGridStyle" TargetType="DataGrid">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="GridLinesVisibility" Value="None"/>
            <Setter Property="RowHeight" Value="48"/>
            <Setter Property="CanUserResizeColumns" Value="False"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <Setter Property="AlternatingRowBackground" Value="#FFF6F6F6"/>
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>

        <Style x:Key="NiceDataGridHeaderStyle" TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="#FF1F2937"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="17"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Padding" Value="10"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>

        <Style x:Key="NiceDataGridRowStyle" TargetType="DataGridRow">
            <Setter Property="Background" Value="White"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#FFE5E7EB"/>
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#FFCBD5E1"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="NiceDataGridCellStyle" TargetType="DataGridCell">
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>

        <Style x:Key="CenteredTextColumnElementStyle" TargetType="TextBlock">
            <Setter Property="TextAlignment" Value="Center"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
        </Style>

        <!-- Small key/value style for invoice summary -->
        <Style x:Key="InvoiceLabelText" TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource TextMutedBrush}"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,0,0,6"/>
        </Style>

        <Style x:Key="InvoiceValueText" TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource TextDarkBrush}"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,0,0,6"/>
        </Style>

    </Page.Resources>

    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Title -->
        <TextBlock Text="تفاصيل الفاتورة"
                   FontSize="26"
                   FontWeight="Bold"
                   Foreground="{StaticResource TextDarkBrush}"
                   Margin="0,0,0,20"/>

        <ScrollViewer Grid.Row="1">
            <StackPanel>

                <!-- ================= Invoice Summary (our frame) ================= -->
                <Border Style="{StaticResource GlowingTableOuterBorder}"
                        Margin="0,0,0,20">

                    <Grid Margin="10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Row 0 -->
                        <TextBlock Grid.Row="0" Grid.Column="0" Text="نوع الفاتورة " Style="{StaticResource InvoiceLabelText}"/>
                        <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding Invoice.Type}" Style="{StaticResource InvoiceValueText}"/>

                        <TextBlock Grid.Row="0" Grid.Column="2" Text="المستلم" Style="{StaticResource InvoiceLabelText}" Margin="18,0,0,6"/>
                        <TextBlock Grid.Row="0" Grid.Column="3" Text="{Binding Invoice.RecipientName}" Style="{StaticResource InvoiceValueText}"/>

                        <!-- Row 1 -->
                        <TextBlock Grid.Row="1" Grid.Column="0" Text="الإجمالي" Style="{StaticResource InvoiceLabelText}"/>
                        <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding Invoice.Amount}" Style="{StaticResource InvoiceValueText}"/>

                        <TextBlock Grid.Row="1" Grid.Column="2" Text="المدفوع" Style="{StaticResource InvoiceLabelText}" Margin="18,0,0,6"/>
                        <TextBlock Grid.Row="1" Grid.Column="3" Text="{Binding Invoice.PaidAmount}" Style="{StaticResource InvoiceValueText}"/>

                        <!-- Row 2 -->
                        <TextBlock Grid.Row="2" Grid.Column="0" Text="المتبقي" Style="{StaticResource InvoiceLabelText}"/>
                        <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding Invoice.RemainingAmount}" Style="{StaticResource InvoiceValueText}"/>

                        <TextBlock Grid.Row="2" Grid.Column="2" Text="تاريخ الاينشاء  " Style="{StaticResource InvoiceLabelText}" Margin="18,0,0,6"/>
                        <TextBlock Grid.Row="2" Grid.Column="3" Text="{Binding Invoice.GeneratedDate}" Style="{StaticResource InvoiceValueText}"/>
                    </Grid>

                </Border>

                <!-- ================= Order Items (our frame + our datagrid) ================= -->
                <Border Style="{StaticResource GlowingTableOuterBorder}"
                        Margin="0,0,0,20">

                    <StackPanel Margin="10">

                        <TextBlock Text="تفاصيل الطلب"
                                   FontSize="20"
                                   FontWeight="Bold"
                                   Foreground="{StaticResource TextDarkBrush}"
                                   HorizontalAlignment="Center"
                                   Margin="0,0,0,12"/>

                        <DataGrid ItemsSource="{Binding OrderItems}"
                                  AutoGenerateColumns="False"
                                  IsReadOnly="True"
                                  CanUserAddRows="False"
                                  ColumnWidth="*"
                                  Style="{StaticResource NiceDataGridStyle}"
                                  ColumnHeaderStyle="{StaticResource NiceDataGridHeaderStyle}"
                                  RowStyle="{StaticResource NiceDataGridRowStyle}"
                                  CellStyle="{StaticResource NiceDataGridCellStyle}">

                            <DataGrid.Columns>

                                <DataGridTextColumn Header="المنتج"
                                                    Binding="{Binding ProductName}"
                                                    Width="*"
                                                    ElementStyle="{StaticResource CenteredTextColumnElementStyle}"/>

                                <DataGridTextColumn Header="الفئة"
                                                    Binding="{Binding CategoryName}"
                                                    Width="*"
                                                    ElementStyle="{StaticResource CenteredTextColumnElementStyle}"/>

                                <DataGridTextColumn Header="الكمية"
                                                    Binding="{Binding Quantity}"
                                                    Width="*"
                                                    ElementStyle="{StaticResource CenteredTextColumnElementStyle}"/>

                                <DataGridTextColumn Header="السعر"
                                                    Binding="{Binding UnitPrice}"
                                                    Width="*"
                                                    ElementStyle="{StaticResource CenteredTextColumnElementStyle}"/>

                                <DataGridTextColumn Header="الإجمالي"
                                                    Binding="{Binding Total}"
                                                    Width="*"
                                                    ElementStyle="{StaticResource CenteredTextColumnElementStyle}"/>

                            </DataGrid.Columns>

                        </DataGrid>

                    </StackPanel>
                </Border>

                <!-- ================= Buttons (same logic) ================= -->
                <StackPanel Orientation="Horizontal">

                    <Button Content="💰 دفع"
                            Width="160"
                            Margin="0,0,12,0"
                            Click="Pay_Click">
                        <Button.Style>
                            <Style TargetType="Button" BasedOn="{StaticResource DarkButtonStyle}">
                                <Setter Property="IsEnabled" Value="True"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Invoice.RemainingAmount}" Value="0">
                                        <Setter Property="IsEnabled" Value="False"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>

                    <Button Content="⬅ رجوع"
                            Width="140"
                            Style="{StaticResource DarkButtonStyle}"
                            Click="Back_Click"/>
                </StackPanel>

            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>
